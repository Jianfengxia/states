# {{ pillar['message_do_not_modify'] }}
{%- if origin_state|default("elasticsearch") == 'elasticsearch' %}
command[elasticsearch_procs]=/usr/lib/nagios/plugins/check_procs -u elasticsearch -c 1:1 -C java -a org.elasticsearch.bootstrap.ElasticSearch
{%- endif %}
{% set nodes_total = 0 -%}
{#- this ugly hack is required to get the total number of nodes -#}
{%- for item in pillar['elasticsearch']['cluster']['nodes'].viewitems() -%}
{#- take 1 off the length to remove the _network key -#}
{%- set nodes_total = nodes_total - 1 + item[1]|length -%}
{%- if loop.last -%}
{%- if origin_state|default("elasticsearch") == 'graylog2' -%}
command[elasticsearch_cluster]=/usr/lib/nagios/plugins/check_elasticsearch_cluster.py -c {{ nodes_total }}:{{ nodes_total }}
{%- else -%}
command[graylog2_elasticsearch_cluster]=/usr/lib/nagios/plugins/check_elasticsearch_cluster.py -c {{ nodes_total }}:{{ nodes_total }}
{%- endif -%}
{%- endfor %}
{%- if origin_state|default("elasticsearch") == 'graylog2' %}
command[graylog2_elasticsearch_port_http]=/usr/lib/nagios/plugins/check_tcp -H 127.0.0.1 -p 9200
command[graylog2_elasticsearch_port_transport]=/usr/lib/nagios/plugins/check_tcp -H 127.0.0.1 -p 9300
{%- else %}
command[elasticsearch_port_http]=/usr/lib/nagios/plugins/check_tcp -H 127.0.0.1 -p 9200
command[elasticsearch_port_transport]=/usr/lib/nagios/plugins/check_tcp -H 127.0.0.1 -p 9300
{%- endif -%}
