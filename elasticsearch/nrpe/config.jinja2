# {{ pillar['message_do_not_modify'] }}
# the following check only work if ES is installed and this is not called for
# Graylog2
command[check_elasticsearch]=/usr/lib/nagios/plugins/check_procs -u elasticsearch -c 1:1 -C java -a org.elasticsearch.bootstrap.ElasticSearch
{% set nodes_total = 0 -%}
{#- this ugly hack is required to get the total number of nodes -#}
{%- for item in pillar['elasticsearch']['cluster']['nodes'].viewitems() -%}
{#- take 1 off the length to remove the _network key -#}
{%- set nodes_total = nodes_total - 1 + item[1]|length -%}
{%- if loop.last -%}
command[check_elasticsearch_cluster]=/usr/lib/nagios/plugins/check_elasticsearch_cluster.py -c {{ nodes_total }}:{{ nodes_total }}
{%- endif -%}
{%- endfor %}
command[check_elasticsearch_http_port]=/usr/lib/nagios/plugins/check_tcp -H 127.0.0.1 -p 9200
command[check_elasticsearch_transport_port]=/usr/lib/nagios/plugins/check_tcp -H 127.0.0.1 -p 9300
