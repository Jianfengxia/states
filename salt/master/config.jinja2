{#- Usage of this is governed by a license that can be found in doc/license.rst -#}

# {{ salt['pillar.get']('message_do_not_modify') }}

fileserver_backend:
  - roots
  - git

{%- if use_ext_pillar %}
ext_pillar:
  - git: {{ salt['pillar.get']('salt_master:pillar:branch', False) }} {{ salt['pillar.get']('salt_master:pillar:remote', False) }}
{%- endif %}

worker_threads: {{ salt['pillar.get']('salt_master:workers', 5) }}
{%- for repo in salt['pillar.get']('salt_master:gitfs_remotes', []) %}
    {%- if loop.first %}
gitfs_remotes:
    {%- endif %}
  - {{ repo }}
{%- endfor %}

log_file: file:///dev/log
{%- if salt['pillar.get']('debug', False) %}
log_level: debug
{%- else %}
log_level: warning
{%- endif %}
log_fmt_logfile: '%(asctime)-15s salt-master[%(process)d] %(name)s: %(message)s'
log_datefmt_logfile: '%b %d %H:%M:%S'
loop_interval: {{ salt['pillar.get']('salt_master:loop_interval', 60) }}
keep_jobs: {{ salt['pillar.get']('salt_master:keep_jobs_hours', 24) }}
{#
TODO: in salt 2014.7 use http://docs.saltstack.com/en/latest/ref/configuration/master.html#master-job-cache
{%- if salt['pillar.get']('sentry_dsn', False) %}
ext_job_cache: sentry_common
{%- endif -%}
#}
{#- access same modules as minion #}
extension_modules: {{ opts['cachedir'] }}/extmods

{%- set sentry_dsn = salt['pillar.get']('sentry_dsn', False) %}
{%- if sentry_dsn %}
sentry_common: {{ sentry_dsn }}
sentry_handler:
  dsn: requests+{{ sentry_dsn }}
{%- endif -%}

{%- if salt['pillar.get']('salt_master:reactor', True) %}
reactor:
  - 'salt/cloud/*/created':
    - /srv/reactor/create/*.sls
  - 'salt/cloud/*/destroyed':
    - /srv/reactor/destroy/*.sls
  - 'salt/job/*/ret/*':
    - /srv/reactor/job/*.sls
  - 'salt-common/alert/*':
    - /srv/reactor/alert/*.sls
{%- endif -%}
