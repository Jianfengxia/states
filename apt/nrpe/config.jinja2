{#-
Use of this source code is governed by a BSD license that can be found
in the doc/license.rst file.

-#}
apt:
  {%- set timeout = 50 %} {#- seconds  #}
  description: APT Updates
  {#-
  Services that don't affect production and that have high cost in CPU, I/O
  and RAM to performs.
  Run them only each 6 hours.
  #}
  check_interval: {{ 6 * 60 }} {#- 6 hours #}
  freshness_threshold: {{ ((6 * 60) + 10) * 60 }} {#- 6 hours + 10 minutes #}
  notifications_enabled: 0
  {#- enable only notification for real error #}
  notification_options: n
  {#- if error, retry 5 times every 3 minutes after any failure, for a max of 15
      minutes #}
  retry_interval: 3
  max_check_attempts: 5
  timeout: {{ timeout }}
  command: /usr/lib/nagios/plugins/
{%- if not salt['pillar.get']('__test__', False) -%}
  check_apt -t {{ timeout }}
{%- else -%}
  check_dummy 0 "No real check in test mode"
{%- endif %}

apt_rc:
  description: APT Not-Purged
  check_interval: {{ 6 * 60 }} {#- 6 hours #}
  freshness_threshold: {{ ((6 * 60) + 10) * 60 }} {#- 6 hours + 10 minutes #}
  notifications_enabled: 0
  notification_options: n
  {#- if error, retry 5 times every 3 minutes after any failure, for a max of 15
      minutes #}
  retry_interval: 3
  max_check_attempts: 5
  timeout: 50
  command: /usr/lib/nagios/plugins/check_apt-rc.py --formula=apt --check=apt_rc
