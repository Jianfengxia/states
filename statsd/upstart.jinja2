{#-
Use of this source code is governed by a BSD license that can be found
in the doc/license.rst file.

Author: Bruno Clermont <bruno@robotinfra.com>
Maintainer: Quan Tong Anh <quanta@robotinfra.com>
-#}
# {{ salt['pillar.get']('message_do_not_modify') }}
# ubuntu upstart script for statsd

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 10 5
umask 022

exec /usr/local/statsd/bin/pystatsd-server --transport graphite --flush-interval 10000 --name {{ grains['id'] }} --graphite-host {{ salt['pillar.get']('graphite_address', False) }} --gauges-prefix '{{ grains['id'] }}.stats' --counters-prefix '{{ grains['id'] }}.stats' --timers-prefix '{{ grains['id'] }}.stats' --pidfile /var/run/pystatsd.pid {% if salt['pillar.get']('debug', False) %}--debug {% endif %}| logger -t "statsd" -p debug
