{#-
Use of this source code is governed by a BSD license that can be found
in the doc/license.rst file.

-#}
# {{ salt['pillar.get']('message_do_not_modify') }}
# startup script for Nginx, inspired from http://wiki.nginx.org/Upstart

respawn
respawn limit 10 5

{#-start on (filesystem and net-device-up IFACE=lo)#}
start on filesystem or runlevel [2345]
stop on runlevel [!2345]

env DAEMON=/usr/sbin/nginx
env PID=/var/run/nginx.pid

pre-start script
    $DAEMON -t || { echo "Nginx: Configuration File Test Failed! See errors using:\n$DAEMON -t" | /usr/bin/mail -s 'Nginx: Configuration File Test Failed on {{ grains['id'] }}' root; stop; exit 0; }
end script

exec $DAEMON -c /etc/nginx/nginx.conf
