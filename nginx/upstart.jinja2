{#-
 Author: Bruno Clermont patate@fastmail.cn
 Maintainer: Bruno Clermont patate@fastmail.cn
 -#}
# {{ pillar['message_do_not_modify'] }}
# startup script for Nginx, inspired from http://wiki.nginx.org/Upstart

respawn
respawn limit 10 5

{#-start on (filesystem and net-device-up IFACE=lo)#}
start on filesystem or runlevel [2345]
stop on runlevel [!2345]

env DAEMON=/usr/sbin/nginx
env PID=/var/run/nginx.pid

pre-start script
    $DAEMON -t
    if [ $? -ne 0 ]
        then exit $?
    fi
end script

exec $DAEMON -c /etc/nginx/nginx.conf
