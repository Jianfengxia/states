{#-
 Author: Bruno Clermont patate@fastmail.cn
 Maintainer: Bruno Clermont patate@fastmail.cn
 -#}
# {{ pillar['message_do_not_modify'] }}
{#-
 This file isn't used directly by nginx NRPE state but it's reused by other
 states that requires on Nginx.
 -#}
{%- set first_ip = salt['network.ip_addrs']()[0] -%}
{%- set effective_http_uri = http_uri|default("/") -%}
{%- if http|default(True) %}
command[{{ deployment }}_nginx_http]=/usr/lib/nagios/plugins/check_http -H {{ domain_name }} -u {{ effective_http_uri }} -p {{ http_port|default(80) }} -e '{{ http_result|default("200 OK") }}' -I {{ first_ip }}{% if timeout|default(False) %} --timeout={{ timeout }}{% endif %}
{% else %}
command[{{ deployment }}_nginx_http]=/bin/echo "HTTP OK: No HTTP for {{ deployment }}"
{% endif %}
{% if https|default(False) -%}
command[{{ deployment }}_nginx_https]=/usr/lib/nagios/plugins/check_http -S -H {{ domain_name }} -u {{ https_uri|default(effective_http_uri) }} -e '{{ https_result|default("200 OK") }}' -I {{ first_ip }}{% if timeout|default(False) %} --timeout={{ timeout }}{% endif %}
command[{{ deployment }}_nginx_https_certificate]=/usr/lib/nagios/plugins/check_http -S -H {{ domain_name }} -C {{ https_max_age|default(60) }} -I {{ first_ip }}
{% else -%}
    {%- for name in ('https', 'https_certificate') %}
command[{{ deployment }}_nginx_{{ name }}]=/bin/echo "HTTP OK: No HTTPS for {{ deployment }}"
    {%- endfor -%}
{%- endif %}
