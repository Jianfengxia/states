{#- Usage of this is governed by a license that can be found in doc/license.rst -#}

# {{ salt['pillar.get']('message_do_not_modify') }}

description "fail2ban - ban hosts that cause multiple authentication errors"

start on (net-device-up
          and local-filesystems
          and runlevel [2345]
          and started rsyslog)
stop on runlevel [!2345]

respawn

env RUNDIR=/var/run/fail2ban

pre-start script
    test -d $RUNDIR || mkdir -p $RUNDIR
    test ! -e $RUNDIR/fail2ban.sock || rm -f $RUNDIR/fail2ban.sock
    /usr/bin/fail2ban-client -x start
end script

script
    while kill -0 $(cat $RUNDIR/fail2ban.pid); do
        sleep 2
    done
end script

pre-stop exec /usr/bin/fail2ban-client stop
