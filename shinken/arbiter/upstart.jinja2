# {{ pillar['message_do_not_modify'] }}
# ubuntu upstart script for shinken-arbiter

start on (filesystem and net-device-up IFACE=eth0)
stop on runlevel [!2345]

respawn

{% set check_command = "/usr/local/shinken/bin/shinken-arbiter --verify-config -c /etc/shinken/arbiter.conf" %}
pre-start script
   {{ check_command }} || { echo "Shinken Arbiter on {{ pillar['shinken']['ip_addresses'][grains['id']] }} contains error(s)! See errors using:\n{{ check_command }}" | /usr/bin/mail -s 'Shinken Arbiter Config Error' {% for user in pillar['shinken']['users'] %}{{ pillar['shinken']['users'][user]['email'] }}{% if not loop.last %} {% endif %}{% endfor %}; stop; exit 0; }
end script

script
  exec /usr/local/shinken/bin/shinken-arbiter -c /etc/shinken/arbiter.conf
  emit shinken-arbiter-arbiter
end script
